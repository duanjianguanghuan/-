tk
from tkinter import messagebox
import sqlite3
import random


# 初始化数据库
def initialize_database():
    conn = sqlite3.connect("users.db")
    cursor = conn.cursor()
    cursor.execute("""
        CREATE TABLE IF NOT EXISTS users (
            username TEXT PRIMARY KEY,
            password TEXT
        )
    """)
    conn.commit()
    conn.close()


# 注册新用户
def register():
    username = username_entry.get()
    password = password_entry.get()
    confirm_password = confirm_password_entry.get()

    if not username or not password or not confirm_password:
        messagebox.showerror("错误", "所有字段必须填写!")
        return

    if password != confirm_password:
        messagebox.showerror("错误", "密码不匹配!")
        return

    conn = sqlite3.connect("users.db")
    cursor = conn.cursor()

    try:
        cursor.execute("INSERT INTO users VALUES (?, ?)", (username, password))
        conn.commit()
        messagebox.showinfo("成功", "注册成功!")
        switch_to_login()
    except sqlite3.IntegrityError:
        messagebox.showerror("错误", "用户名已存在!")
    finally:
        conn.close()


# 登录验证
def login():
    username = username_entry.get()
    password = password_entry.get()

    if not username or not password:
        messagebox.showerror("错误", "用户名和密码必须填写!")
        return

    conn = sqlite3.connect("users.db")
    cursor = conn.cursor()
    cursor.execute("SELECT * FROM users WHERE username=? AND password=?", (username, password))
    user = cursor.fetchone()
    conn.close()

    if user:
        messagebox.showinfo("成功", f"欢迎, {username}!")
        open_game(username)
    else:
        messagebox.showerror("错误", "用户名或密码错误!")


# 打开游戏
def open_game(username):
    login_frame.pack_forget()
    register_frame.pack_forget()

    game_frame = tk.Frame(root)
    game_frame.pack(padx=20, pady=20)

    tk.Label(game_frame, text=f"欢迎, {username}！", font=('Arial', 16)).pack(pady=10)

    # 简单的猜数字游戏
    number = random.randint(1, 10)
    tries_left = 3

    def check_guess():
        nonlocal tries_left
        guess = int(guess_entry.get())
        if guess == number:
            messagebox.showinfo("恭喜", "你猜对了!")
            game_frame.pack_forget()
            switch_to_login()
        else:
            tries_left -= 1
            if tries_left > 0:
                messagebox.showinfo("提示", f"猜错了! 还有 {tries_left} 次机会!")
            else:
                messagebox.showinfo("游戏结束", f"很遗憾, 正确答案是 {number}!")
                game_frame.pack_forget()
                switch_to_login()

    tk.Label(game_frame, text="猜一个 1 到 10 的数字:").pack(pady=5)
    guess_entry = tk.Entry(game_frame)
    guess_entry.pack(pady=5)
    tk.Button(game_frame, text="提交", command=check_guess).pack(pady=5)


# 切换到登录界面
def switch_to_login():
    register_frame.pack_forget()
    login_frame.pack()


# 切换到注册界面
def switch_to_register():
    login_frame.pack_forget()
    register_frame.pack()


# 初始化窗口
root = tk.Tk()
root.title("游戏登录和注册系统")
root.geometry("400x300")

initialize_database()

# 登录界面
login_frame = tk.Frame(root)
login_frame.pack(padx=20, pady=20)

tk.Label(login_frame, text="登录", font=('Arial', 16)).pack(pady=10)
tk.Label(login_frame, text="用户名:").pack()
username_entry = tk.Entry(login_frame)
username_entry.pack(pady=5)
tk.Label(login_frame, text="密码:").pack()
password_entry = tk.Entry(login_frame, show="*")
password_entry.pack(pady=5)
tk.Button(login_frame, text="登录", command=login).pack(pady=5)
tk.Button(login_frame, text="没有账号? 点击注册", command=switch_to_register).pack()

# 注册界面
register_frame = tk.Frame(root)

tk.Label(register_frame, text="注册", font=('Arial', 16)).pack(pady=10)
tk.Label(register_frame, text="用户名:").pack()
username_entry = tk.Entry(register_frame)
username_entry.pack(pady=5)
tk.Label(register_frame, text="密码:").pack()
password_entry = tk.Entry(register_frame, show="*")
password_entry.pack(pady=5)
tk.Label(register_frame, text="确认密码:").pack()
confirm_password_entry = tk.Entry(register_frame, show="*")
confirm_password_entry.pack(pady=5)
tk.Button(register_frame, text="注册", command=register).pack(pady=5)
tk.Button(register_frame, text="已有账号? 点击登录", command=switch_to_login).pack()

root.mainloop()
